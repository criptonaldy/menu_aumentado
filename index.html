<!DOCTYPE html>
<html>
<head>
    <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    
    <style>
        /* RESET COMPLETO - PANTALLA LLENA */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        html, body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #111111;
            position: fixed;
            top: 0;
            left: 0;
            touch-action: none;
        }
        
        /* MODELO 3D - OCUPA TODO */
        model-viewer {
            width: 100%;
            height: 100%;
            --poster-color: transparent;
            --progress-bar-color: transparent;
            --progress-bar-height: 0px;
        }
        
        /* BOT√ìN AR MUY DISCRETO */
        .ar-btn {
            position: absolute;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, #FF6B6B 0%, #FF8E53 100%);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 700;
            letter-spacing: 0.5px;
            z-index: 1000;
            opacity: 0.95;
            box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 200px;
            justify-content: center;
        }
        
        .ar-btn:hover, .ar-btn:active {
            opacity: 1;
            transform: translateX(-50%) scale(1.05);
            box-shadow: 0 12px 30px rgba(255, 107, 107, 0.6);
        }
        
        /* ANIMACI√ìN DE PULSO */
        @keyframes pulse-glow {
            0% { box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4); }
            50% { box-shadow: 0 8px 30px rgba(255, 107, 107, 0.7); }
            100% { box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4); }
        }
        
        .ar-btn.pulse {
            animation: pulse-glow 2s infinite;
        }
        
        /* LOADING INVISIBLE */
        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 14px;
            opacity: 0;
            pointer-events: none;
        }
        
        /* MENSAJE TEMPORAL */
        .hint {
            position: absolute;
            top: 25px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.85);
            color: white;
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 14px;
            z-index: 999;
            opacity: 0;
            animation: fadeInOut 4s ease;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            max-width: 85%;
            line-height: 1.4;
        }
        
        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
            15% { opacity: 1; transform: translateX(-50%) translateY(0); }
            85% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }
        
        /* COMPATIBILIDAD */
        .compat-alert {
            display: none;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 25px;
            border-radius: 15px;
            text-align: center;
            max-width: 300px;
            border: 2px solid #FF6B6B;
            z-index: 1001;
            backdrop-filter: blur(15px);
        }
        
        .compat-alert.visible {
            display: block;
        }
        
        .compat-btn {
            background: #FF6B6B;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            margin-top: 15px;
            cursor: pointer;
            font-weight: bold;
            width: 100%;
        }
        
        /* VERSI√ìN M√ìVIL */
        @media (max-width: 768px) {
            .ar-btn {
                bottom: 30px;
                padding: 16px 40px;
                font-size: 17px;
                min-width: 220px;
            }
            
            .hint {
                top: 20px;
                font-size: 13px;
                padding: 10px 18px;
            }
        }
        
        /* iOS ESPEC√çFICO */
        .ios-ar-hint {
            display: none;
            position: absolute;
            bottom: 90px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.9);
            font-size: 13px;
            text-align: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 10px;
            z-index: 999;
        }
    </style>
</head>
<body>
    <!-- MENSAJE TEMPORAL -->
    <div class="hint" id="hint">üå± Escanea una superficie plana con el bot√≥n de abajo</div>
    
    <!-- PARA iOS -->
    <div class="ios-ar-hint" id="iosHint">En iPhone: toca "Compartir" ‚Üí "Ver en AR"</div>
    
    <!-- ALERTA DE COMPATIBILIDAD -->
    <div class="compat-alert" id="compatAlert">
        <h3>üì± AR Recomendado</h3>
        <p>Para mejor experiencia:</p>
        <p><strong>Android:</strong> Usa Google Chrome</p>
        <p><strong>iPhone:</strong> Usa Safari</p>
        <button class="compat-btn" onclick="hideAlert()">ENTENDIDO</button>
    </div>
    
    <!-- MODELO 3D -->
    <model-viewer
        id="arViewer"
        src="planta_napolitana.glb"
        ar
        ar-modes="webxr" <!-- CLAVE: SOLO WebXR, NO pide apps -->
        camera-controls
        auto-rotate
        auto-rotate-delay="0"
        environment-image="neutral"
        shadow-intensity="1.3"
        exposure="1.1"
        interaction-prompt="none"
        ar-scale="fixed"
        ar-placement="floor"
        field-of-view="65deg"
        camera-orbit="0deg 75deg 2.5m"
        style="width: 100%; height: 100%;">
        
        <!-- BOT√ìN AR -->
        <button class="ar-btn pulse" id="arButton" slot="ar-button">
            <span style="font-size: 20px;">üëÅÔ∏è</span>
            <span>VER EN TU ESPACIO</span>
        </button>
        
    </model-viewer>
    
    <!-- LOADING -->
    <div class="loading" id="loading">Cargando modelo 3D...</div>

    <script>
        // ELEMENTOS
        const viewer = document.getElementById('arViewer');
        const arButton = document.getElementById('arButton');
        const hint = document.getElementById('hint');
        const iosHint = document.getElementById('iosHint');
        const compatAlert = document.getElementById('compatAlert');
        const loading = document.getElementById('loading');
        
        // DETECTAR DISPOSITIVO
        const isIOS = /iPhone|iPad|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        const isChrome = /Chrome/.test(navigator.userAgent) && !/Edge|Edg/.test(navigator.userAgent);
        const isSafari = /Safari/.test(navigator.userAgent) && !/Chrome/.test(navigator.userAgent);
        
        // CONFIGURAR SEG√öN DISPOSITIVO
        function configureForDevice() {
            if (isIOS && isSafari) {
                // iPhone con Safari - iOS AR funciona bien
                console.log('üì± iPhone Safari detectado');
                setTimeout(() => {
                    iosHint.style.display = 'block';
                    setTimeout(() => {
                        iosHint.style.display = 'none';
                    }, 5000);
                }, 2000);
            }
            else if (isAndroid && !isChrome) {
                // Android sin Chrome - mostrar alerta
                setTimeout(() => {
                    compatAlert.classList.add('visible');
                }, 3000);
            }
        }
        
        // CUANDO CARGA EL MODELO
        viewer.addEventListener('load', () => {
            console.log('‚úÖ planta_napolitana.glb cargado');
            
            // Ocultar hint despu√©s de 4 segundos
            setTimeout(() => {
                hint.style.opacity = '0';
                setTimeout(() => hint.style.display = 'none', 500);
            }, 4000);
            
            // Configurar dispositivo
            configureForDevice();
            
            // Verificar si WebXR est√° disponible
            checkWebXRSupport();
        });
        
        // VERIFICAR SOPORTE WEBXR
        function checkWebXRSupport() {
            if ('xr' in navigator) {
                navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
                    if (!supported) {
                        // WebXR no soportado - cambiar bot√≥n
                        arButton.innerHTML = '<span>üì±</span> <span>AR NO DISPONIBLE</span>';
                        arButton.style.background = 'linear-gradient(135deg, #666 0%, #999 100%)';
                        arButton.classList.remove('pulse');
                        arButton.disabled = true;
                    }
                });
            }
        }
        
        // CUANDO ENTRA EN AR
        viewer.addEventListener('enter-ar', () => {
            console.log('üéâ AR activado');
            
            // Ocultar bot√≥n
            arButton.style.opacity = '0';
            setTimeout(() => {
                arButton.style.display = 'none';
            }, 300);
            
            // Ocultar hint
            hint.style.display = 'none';
            iosHint.style.display = 'none';
            compatAlert.classList.remove('visible');
        });
        
        // CUANDO SALE DE AR
        viewer.addEventListener('exit-ar', () => {
            console.log('üëã Saliendo de AR');
            
            // Mostrar bot√≥n nuevamente
            arButton.style.display = 'flex';
            setTimeout(() => {
                arButton.style.opacity = '0.95';
            }, 100);
        });
        
        // OCULTAR ALERTA
        function hideAlert() {
            compatAlert.classList.remove('visible');
        }
        
        // AUTO-GIRO PARA ATRAER ATENCI√ìN
        setTimeout(() => {
            viewer.autoRotate = true;
            setTimeout(() => {
                viewer.autoRotate = false;
            }, 3000);
        }, 1000);
        
        // INICIAR
        window.onload = () => {
            loading.style.opacity = '1';
            setTimeout(() => {
                loading.style.opacity = '0';
            }, 1500);
        };
    </script>
</body>
</html>
